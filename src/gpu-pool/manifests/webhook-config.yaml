apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: gpu-pool-webhook
webhooks:
- name: gpu-pool.mrxrunway.ai
  clientConfig:
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURiVENDQWxXZ0F3SUJBZ0lVSjBONG5idWtjRElPM0NiMTM5YVlQcXdreWY4d0RRWUpLb1pJaHZjTkFRRUwKQlFBd1JqRUxNQWtHQTFVRUJoTUNTMUl4RGpBTUJnTlZCQWdNQlZObGIzVnNNUkV3RHdZRFZRUUtEQWhIVUZVdApVRzl2YkRFVU1CSUdBMVVFQXd3TFozQjFMWEJ2YjJ3dFkyRXdIaGNOTWpVeE1ERTJNREl3T1RJM1doY05NelV4Ck1ERTBNREl3T1RJM1dqQkdNUXN3Q1FZRFZRUUdFd0pMVWpFT01Bd0dBMVVFQ0F3RlUyVnZkV3d4RVRBUEJnTlYKQkFvTUNFZFFWUzFRYjI5c01SUXdFZ1lEVlFRRERBdG5jSFV0Y0c5dmJDMWpZVENDQVNJd0RRWUpLb1pJaHZjTgpBUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBSytQZ29RMHpiR2h4cldpb0kwZm9DZDJGL2xDRkw3SDhKQVpTYUNGCkt3QXlhMVYvYm9WSlFJZDhpejJiMDBBZTZHdmxLR2U2NHA5bVY0K1pJaG5wRFJwM2JxSFdQN0JYaG5QWExCcjMKVWh3enhCalI0K0p0RDZ1MkpFcVRhODV3QXhUUjF3a2RGbWVpbzhzbFNXT0xkWXdRdXloZTNpVVVDdEEvYWVJUApHSkk2OFA0Y3N4VFlWOTZOVnNPUDhjZ2ZPYmVhaUlBb1JXZDVwNitDQmY4Z2tuZ2Y2b0RUUVdIL0VjL3VzM3Z3CnZjVDlBRFNnUmVGRDZ5aldGV0ZMeWc2bWJLWjBZVXNDNmpacTJJd0JOZk1FQUhDSzRFOTFYU1RUYk5KcmJWdzEKUm9xaDdyaUpXcEFaT0x2bldmQVBBMDNrc3F2SDh2U3FqNjJKRC9ldEJYOXlJN3NDQXdFQUFhTlRNRkV3SFFZRApWUjBPQkJZRUZNSTBYWWZGZnhSQmg2MWR4aXFLdUFhOFYya0pNQjhHQTFVZEl3UVlNQmFBRk1JMFhZZkZmeFJCCmg2MWR4aXFLdUFhOFYya0pNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUIKQUdyK3dUT0RRYXBrSVlBY0g1VnBvSFgxTHZtOVlXL0VxMFpRNEVJTGdwYXpsODBFMjRVdEZtV2syNEZaYUxWMQp0Z1JIOERmZHM3cjBXd3huUURNNkgwdDR0NmlOWnM0cFhSLzl2QTF2Z1ZkdUJ1bUJNN0tSYWNVZVlaMlQ0dlNKCnNBdkhMN29ydUtlVWxwNjJoanV4UUxHSjM4bUVWcVJXYitPVzFPd3BySzN4UGlYak9PNWs4TXUrbEkzV3MxZTgKMEVGU2drOGVmbTJ0bG50NzNRV0UzZWFoYnhXLzVDM1VuWGE3S0lYSlduMU1GNGg3elNTVXdOMXp3TU84WjVPMgp3UmlVZUswTW1HcFJUUmwzT2NhcFpoRDlFSTdqNTlXSGo0Z1ZDMk0wdDdsUEVRZHB0UVRtdnl4VW95a1RkYXdGCllWOUJZOHVYOHAweGZGd2VwMUhUOXFBPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    service:
      name: gpu-pool-webhook
      namespace: gpu-pool
      path: "/mutate"
  rules:
  - operations: ["CREATE"]
    apiGroups: [""]
    apiVersions: ["v1"]
    resources: ["pods"]
  admissionReviewVersions: ["v1", "v1beta1"]
  sideEffects: None
  failurePolicy: Fail  # Webhook 실패 시에도 Pod 생성 허용
  namespaceSelector:
    matchExpressions:
    - key: name
      operator: NotIn
      values: ["kube-system", "gpu-pool"]  # 시스템 네임스페이스 제외
